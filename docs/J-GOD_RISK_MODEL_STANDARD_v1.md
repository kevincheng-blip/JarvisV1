# J-GOD 風險模型 v1.0 標準規範

> **重要**：這是 J-GOD 風險模型的基準標準，所有風險相關模組必須遵循此規範。

---

## 🎯 核心原則

**八大風險因子 = J-GOD Risk Model 的標準架構**

所有風險計算、分解、監控都必須基於這八大因子進行。

---

## 📊 八大風險因子定義

### 系統性風險因子 (Systemic Risk Factors)

#### 1. **R-MKT** - 市場系統性風險 (Market Beta)
- **經濟意義**：衡量股票報酬對大盤指數的敏感度
- **計算公式**：R-MKT = 當期市場指數報酬
- **標準名稱**：`R_MKT`
- **應用**：市場 Beta 結構、系統性風險暴露

#### 2. **R-SIZE** - 規模風險 (Size)
- **經濟意義**：捕捉大市值 vs. 小市值之間的系統性差異，小型股具更高波動與流動性風險
- **計算公式**：R-SIZE = 小市值組合報酬 − 大市值組合報酬
- **標準名稱**：`R_SIZE`
- **應用**：小/大市值風險分解、流動性風險

#### 3. **R-VAL** - 價值風險 (Value)
- **經濟意義**：衡量高帳面價值（低股價）vs. 低帳面價值（高股價）公司間報酬差
- **計算公式**：R-VAL = 高 B/M 組合報酬 − 低 B/M 組合報酬
- **標準名稱**：`R_VAL`
- **應用**：價值/成長風險暴露

#### 4. **R-MOM** - 動量風險 (Momentum)
- **經濟意義**：捕捉過去表現好的股票 vs. 表現差股票的風險差
- **計算公式**：R-MOM = 贏家組合報酬 − 輸家組合報酬
- **標準名稱**：`R_MOM`
- **應用**：動能風險、趨勢風險

### 特質性與另類風險因子 (Idiosyncratic & Alternative Risk Factors)

#### 5. **R-LIQ** - 流動性風險 (Liquidity)
- **經濟意義**：衡量股票交易的難易程度，低流動性具高價差與清算風險
- **計算公式**：R-LIQ = (成交量 × 股價) / 市值 或 Amihud Illiquidity
- **標準名稱**：`R_LIQ`
- **應用**：流動性風險、交易成本風險

#### 6. **R-VOL** - 波動率風險 (Volatility)
- **經濟意義**：捕捉高波動股票 vs. 低波動股票的差異
- **計算公式**：R-VOL = 高波動率組合報酬 − 低波動率組合報酬
- **標準名稱**：`R_VOL`
- **應用**：波動率風險、均值回歸風險

#### 7. **R-FX/IR** - 匯率/利率風險 (FX / Interest Rate)
- **經濟意義**：衡量股票對匯率變動、利率變動（如公債殖利率）的暴露度
- **計算公式**：R-FX/IR = 主要貨幣匯率變動 + 公債殖利率變動
- **標準名稱**：`R_FX_IR`
- **應用**：金融/電子/傳產行業風險、利率敏感度

#### 8. **R-FLOW** - 生態圈資金流風險 (Ecosystem Flow Risk) ⭐
- **經濟意義**：**J-GOD 獨有因子**。衡量高資金流暴露的股票在資金流逆轉時的拋壓風險
- **計算公式**：R-FLOW = 高 Flow 暴露組合報酬 − 低 Flow 暴露組合報酬
- **標準名稱**：`R_FLOW`
- **應用**：J-GOD 專屬系統性風險、資金流風險補償

---

## 🔗 Alpha Engine 與風險因子對應關係

| Alpha 因子 | 風險因子 | 對應關係說明 |
|-----------|---------|-------------|
| **Flow Alpha** | **R-FLOW** | 風險補償關係 |
| **Reversion Alpha** | **R-VOL** | 均值回歸與波動反向 |
| **Inertia Alpha** | **R-MOM** | 動能風險 |
| **Value/Quality Alpha** | **R-VAL** | 價值風險 |
| 台股大盤 | **R-MKT** | 市場 β 結構 |
| 小/大市值 | **R-SIZE** | 流動性風險 |
| 金融/電子/傳產 | **R-FX/IR** | 匯率 + 利率敏感度 |

---

## 🏗️ 風險模型計算流程標準

### 1. 計算每日八大風險因子報酬
- 透過組合淨值或迴歸法估算
- 使用標準因子計算方法

### 2. 建立八因子協方差矩陣
- 使用 **120-250 天**的歷史數據
- 產生 **Σ_Risk** (8×8 協方差矩陣)

### 3. 計算個股風險暴露 X_i
- 對每檔股票進行多因子迴歸
- 得到每個股票對八大因子的暴露度

### 4. 計算投資組合總風險
```
σ²_p = wᵀ X Σ_Risk Xᵀ w + wᵀ Δ w
```
其中：
- **w** = 權重向量
- **X** = 因子暴露度矩陣 (n_stocks × 8_factors)
- **Σ_Risk** = 八因子協方差矩陣 (8×8)
- **Δ** = 特質性風險矩陣 (對角矩陣)

---

## 📐 應用場景標準

### ✅ Backtest Engine（回測引擎）
- 必須計算投資組合的八大因子暴露
- 分解回測期間的風險來源
- 計算風險調整後的報酬指標

### ✅ Portfolio Risk Calculation（投資組合風險計算）
- 使用八大因子協方差矩陣
- 分解為因子風險與特質風險
- 提供風險歸因分析

### ✅ Path A 資料分析
- 計算歷史風險因子收益
- 建立風險因子時間序列
- 支援 Walk-Forward 分析

### ✅ Error Learning Engine（錯誤學習引擎）
- ErrorEvent 分類可依據風險因子來源
  - 例如：R-FLOW 風險過高、R-MOM 風險暴露過大
- 分析預測錯誤的風險因子貢獻

### ✅ Walk-Forward Module（滾動前進模組）
- 使用風險因子進行 Regime Shift 篩選
- 評估不同市場環境下的風險暴露
- 動態調整風險模型參數

### ✅ 淨值曲線最大回撤判斷
- 分析最大回撤期間的風險因子暴露
- 識別導致回撤的主要風險來源
- 提供風險歸因報告

---

## 🔑 關鍵記憶點

1. **標準因子名稱**：使用 `R_MKT`, `R_SIZE`, `R_VAL`, `R_MOM`, `R_LIQ`, `R_VOL`, `R_FX_IR`, `R_FLOW`

2. **R-FLOW 是 J-GOD 專屬因子**，與 Flow Alpha 相對應

3. **所有風險計算必須基於這八大因子**

4. **因子協方差矩陣必須使用 120-250 天歷史數據**

5. **Alpha 因子與風險因子有明確對應關係**

---

## 📚 參考文件

- `docs/J-GOD風險模型八大風險因子_AI知識庫版_v1.md` - 理論定義
- `jgod/risk/risk_factors.py` - 風險因子計算實作
- `jgod/risk/risk_model.py` - 多因子風險模型核心
- `jgod/risk/portfolio_risk.py` - 投資組合風險計算

---

**版本**：v1.0  
**最後更新**：2024-12-01  
**狀態**：✅ 標準規範已確立

---

## Step 4 細化：完整風險模型 Σ = B F Bᵀ + D（Full Risk Model Specification）

本章定義 J-GOD 風險模型（Risk Model）的完整數學結構與參數估計方法。

本標準是 Path A、Backtest、Optimizer、War Room Risk Monitor 所共同遵循的統一規格。

---

### 4.1 風險分解架構（Risk Decomposition）

J-GOD 使用標準的 **多因子風險模型**（Multi-Factor Risk Model）：

```
Σ = B F Bᵀ + D
```

其中：

| 變數 | 定義 | 維度 |
|------|------|------|
| **Σ** | 投資組合總風險的協方差矩陣 | (N × N) |
| **B** | 因子暴露矩陣（Factor Exposure Matrix） | (N × K) |
| **F** | 因子協方差矩陣（Factor Covariance Matrix） | (K × K) |
| **D** | 特有風險對角矩陣（Specific Risk） | (N × N, 但僅使用對角) |

**說明**：

- **因子風險 (B F Bᵀ)**：由系統性與另類因子所解釋的可預測風險
- **特有風險 (D)**：每支股票自身無法以因子解釋之殘差風險

這是 J-GOD 系統所有風險計算的最終標準。

---

### 4.2 因子暴露 (Betas, B) 的估計方法

使用 **加權最小平方法**（WLS Regression）：

```
R_i = B_i F + ε_i
```

**規格**：

| 項目 | 說明 |
|------|------|
| **回歸窗口** | 過去 12 個月交易日（約 252 個交易日） |
| **權重** | 使用半衰期 60 的 EWMA（近期權重較高） |
| **Outlier 處理** | 對股票與因子報酬做 ±3σ Winsorization |
| **更新頻率** | 每月更新一次（維持 Beta 穩定性） |

**結果**：

- 取得矩陣 **B**（N × K）
- 取得特有殘差 **ε**（用於 D 的計算）

---

### 4.3 因子協方差矩陣 (Factor Covariance, F) 的估計方法

使用 **EWMA**（指數加權移動平均）協方差矩陣：

```
Cov_t = λ Cov_{t-1} + (1 - λ) r_t r_tᵀ
```

**規格**：

| 項目 | 說明 |
|------|------|
| **資料來源** | 八大風險因子的每日報酬時間序列 |
| **模型** | EWMA 協方差 |
| **衰減係數 λ** | 0.94（金融界標準） |
| **更新頻率** | 每日更新 |

**效果**：

- 使 F 對市場 regime 變化高度敏感
- 可即時反映波動擴張（高 VIX）時期

---

### 4.4 特有風險 (Specific Risk, D) 的估計方法

**來源**：

使用 Beta 回歸中的殘差 ε_i：

```
D_i = Var(ε_i)
```

**方法**：

| 項目 | 說明 |
|------|------|
| **模型** | EWMA（與 F 相同） |
| **資料來源** | 回歸殘差 ε_i² |
| **矩陣型態** | 對角矩陣 |
| **更新頻率** | 每日更新 |

**效果**：

- 更快速反映個股事件（財報爆雷、新聞衝擊）
- 不受因子波動污染

---

### 4.5 J-GOD 八大風險因子（重申標準）

| 風險因子代號 | 說明 |
|-------------|------|
| **R-MKT** | 市場系統性風險（Market） |
| **R-SIZE** | 規模因子（Small - Big） |
| **R-VAL** | 價值因子（Value） |
| **R-MOM** | 動量因子（Momentum） |
| **R-LIQ** | 流動性風險（Liquidity） |
| **R-VOL** | 波動率因子（High Vol - Low Vol） |
| **R-FX_IR** | 匯率/利率風險（FX & Rates） |
| **R-FLOW** | J-GOD 生態資金流風險（Flow Ecosystem） |

※ 所有「因子收益」的來源均依本標準計算。

---

### 4.6 整體風險計算流程（J-GOD統一流程）

1. 取得因子日報酬（八大因子）
2. 估計因子協方差矩陣 F（每日）
3. 計算股票報酬
4. 迴歸取得 Beta（每月）→ **B**
5. 計算殘差 → EWMA → 特有風險 **D**（每日）
6. 建構 **Σ = B F Bᵀ + D**

**套用至**：

- Backtesting Engine
- Walk-Forward Engine
- Portfolio Optimizer（Step 5）
- War Room Risk Monitor（Regime Shift Sensing）
- Path A 策略錯誤分類（ErrorLearningEngine）

---

### 4.7 本章之規格為強制標準

所有使用風險模型的模組（Backtest、Path A、Optimizer、Risk Monitor）皆必須完全遵守以上定義與更新頻率，並以 **Σ = B F Bᵀ + D** 作為最終風險衡量公式。

---

（章節結束）

