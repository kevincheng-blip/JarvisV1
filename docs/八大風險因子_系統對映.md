# J-GOD 八大風險因子 × 系統對映表（System Mapping）

本文件定義八大風險因子（R_MKT, R_SIZE, R_VAL, R_MOM, R_LIQ, R_VOL, R_FX_IR, R_FLOW）在整個 J-GOD 系統中的角色、用途、讀寫來源、更新頻率與模組間的資料流向。

---

## 1. 八大風險因子一覽表

| Risk Code | 中文名稱 | 類型 | 來源數據 | 更新頻率 | 用途模組 |
|----------|----------|------|-----------|-----------|-------------|
| R_MKT | 市場風險 | 系統性 | 大盤指數報酬 | 每日 | Risk Model / Optimizer / Backtest |
| R_SIZE | 規模風險 | 系統性 | 大/小市值組合 | 每日 | Risk Model / Optimizer / Backtest |
| R_VAL | 價值風險 | 系統性 | B/M 組合 | 每日 | AlphaEngine / Risk Model / Optimizer |
| R_MOM | 動量風險 | 系統性 | 贏家/輸家組合 | 每日 | Risk Model / Walk-Forward |
| R_LIQ | 流動性風險 | 微觀 | 成交量、市值 | 每日 | Path A / Risk Model / ErrorLearning |
| R_VOL | 波動風險 | 微觀 | 歷史波動率 | 每日 | AlphaEngine / Risk Model / Walk-Forward |
| R_FX_IR | 匯率/利率風險 | 宏觀 | 匯率 + 公債殖利率 | 每日 | MacroEngine / Risk Model |
| R_FLOW | 生態資金流風險 | J-GOD 專屬 | Flow Alpha + 生態圈 | 每日 | AlphaEngine / Risk Model / ErrorLearning |

---

## 2. 模組 → 風險因子對映關係

### 2.1 Alpha Engine

使用以下風險因子進行對應：

- flow → R_FLOW  

- reversion → R_VOL  

- inertia → R_MOM  

- value_quality → R_VAL  

輸出：alpha_df（可直接轉為因子暴露 B）

---

### 2.2 Risk Model

Risk Model 必須讀取並使用所有八大因子：

- 用於計算因子報酬（Factor Returns）

- 用於估計因子協方差矩陣 F（EWMA）

- 用於計算股票 betas（B）

- 用於計算特有風險（D）

- 最終組成 Σ = B F Bᵀ + D

---

### 2.3 Portfolio Risk

使用 Risk Model 的產物：

- portfolio_exposure = wᵀB

- portfolio_risk = wᵀΣw

- decompose_portfolio_risk_by_factor() 必須按八大因子拆解

---

### 2.4 Backtest Engine

使用：

- R_MKT、R_VOL、R_MOM、R_FLOW 作為 regime shift 參考

- 使用 Σ 做回撤模擬與風險追蹤

---

### 2.5 Walk-Forward Engine

使用：

- R_MOM（動量 regime）

- R_VOL（波動 regime）

- R_FLOW（資金 regime）

用途：

- 判斷 regime 並選擇最佳模型或參數集

---

### 2.6 Error Learning Engine

ErrorEvent 必須分類：

- 風險因子來源（如 R_VOL 導致爆掉、R_FLOW 反轉 等）

- 是否因為 Σ、B、F、D 計算異常

---

### 2.7 Path A（Validation Lab）

使用：

- 八大因子計算「因子報酬歷史序列」

- 訓練 risk model（B, F, D）

- 優化 Walk-Forward regime 候選期間

---

## 3. Data Pipeline：八大因子在資料流程中的位置

### (1) DataFetcher → Path A

取回：

- 價格、成交量、市值

- 匯率、公債殖利率

- 市值分類（建立 Size portfolios）

- 動量組合排序

- Flow 生態圈暴露

### (2) Path A → Risk Model

提供：

- 因子報酬序列（8 × T）

- 股票報酬序列（N × T）

### (3) Risk Model → Optimizer

提供：

- B（因子暴露矩陣）

- F（因子協方差矩陣）

- D（特有風險矩陣）

- Σ（完整協方差矩陣）

---

## 4. 強制規範（必須遵守）

1. 全系統所有模組只能使用這八大風險因子

2. 所有風險分析均需遵守 Σ = B F Bᵀ + D

3. B 使用 12 個月 WLS + EWMA half-life 60

4. F 使用 EWMA λ = 0.94

5. D 使用 EWMA 殘差方差

6. 所有因子更新頻率 = 每日

7. AlphaEngine 與 RiskModel 的名稱必須一致（R_MKT … R_FLOW）

---

