# Path A 歷史回測撈取資料＋分析 - CORRECTED 版

> **說明**：本版本在 ENHANCED 基礎上，補齊公式、統計定義、量化金融標準算法，並標註所有補強的來源層級。

> **來源標記**：[原文] | [重寫整理] | [補充說明] | [外部知識補強] | [修正建議]

---

> **說明**：本版本在 STRUCTURED 基礎上，拆解邏輯步驟，添加程序化說明與白話注解。

> **原則**：不糾錯、不補外部資料、不改原意，只讓邏輯更清楚。

---


> **說明**：本版本忠於原文，僅做結構化整理，建立清晰的章節標題與分類。

---


> **重要說明**：本文件為 AI 知識庫格式，每段內容都已標記分類標籤，可直接被 AI 模型解析、轉換為 JSON、向量化或規則引擎使用。
> 
> **原始文件**：`docs/Path A  歷史回測撈取資料＋分析.txt`（未修改）
> **建立日期**：2024-11-28


## 文件說明

本文件是 J-GOD 股神作戰系統的「Path A：歷史回測」數據撈取規格來源，定義了完整的歷史數據需求清單、數據維度、以及頂級量化機構（Citadel、Renaissance Technologies）的數據策略。

本文檔定義了 J-GOD 系統的「歷史數據撈取」核心框架，包括：
- 核心交易與價格訊號數據
- 籌碼與資金流向數據
- 基本面與價值結構數據
- 宏觀與外部風險數據
- 還原股價的重要性
- 嚴格時間戳記隔離原則


## 一、歷史資料撈取清單（半年期）


### 1.1 核心標的（The "Who"）

**主要回測標的**：
- **台灣加權指數**：TSE001（大盤指數）
  - 目的：建立 J-GOD 的核心運作數據

**對照基準**：
- **任意個股**（例如台積電）：2330.TW 或您的目標個股
  - 目的：用於策略驗證和 Alpha 比較


### 1.2 必須撈取的欄位（The "What"）

**[程式化說明]**
此結構可用 dataclass 或 DataFrame 表示。


這些欄位是計算因子、模擬交易和績效分析的最基本輸入。

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```


**[程式化說明]**
此結構可用 dataclass 或 DataFrame 表示。


| 欄位名稱 | 欄位目的 | 作用的理論模組 | 嚴謹性要求 |

**[程式化說明]**
此模組可對應到 Python 類別（class）或套件結構。

**[白話註解]**
這是一個功能單元，可以獨立開發與測試。


**[程式化說明]**
此結構可用 dataclass 或 DataFrame 表示。

|---------|---------|--------------|-----------|
| **Date (日期)** | 建立時間序列，確保滾動式調整的時序正確性 | Walk-Forward Engine | 必須是交易日序列，且無跳日 |

**[程式化說明]**
此模組可對應到 Python 類別（class）或套件結構。

**[白話註解]**
這是一個功能單元，可以獨立開發與測試。

| **Adjusted Close Price (還原收盤價)** | 核心！計算 PnL、報酬率和 F_C（動量因子）的唯一基礎 | Performance Analyzer, F_C | 必須是經過除權息還原的價格，避免假性獲利 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **Open Price (開盤價)** | 模擬交易的進場價 | Performance Analyzer | 嚴謹回測中，訊號是收盤後產生，應在隔日開盤進場 |
| **Low Price (最低價)** | 模擬盤中風控（Max Drawdown 模擬） | DQA / Risk Budgeting | 輔助 DQA 判斷單日波動是否異常 |

**[外部知識補強]**
最大回撤（Max Drawdown）計算：

1. 計算累積淨值序列：$C_t = \prod_{i=1}^{t} (1 + r_i)$
2. 計算歷史最高點：$P_t = \max(C_1, C_2, ..., C_t)$
3. 計算回撤：$D_t = \frac{P_t - C_t}{P_t}$
4. 最大回撤 = $\max(D_1, D_2, ..., D_T)$

Python 實作：
```python
cumulative = (1 + returns).cumprod()
running_max = cumulative.expanding().max()
drawdown = (cumulative - running_max) / running_max
max_drawdown = drawdown.min()
```

| **Trading Volume (成交量)** | 計算 F_Inertia（慣性因子）的關鍵輸入 | F_Inertia | 用於衡量市場的資金參與度 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```



### 1.3 撈取時程規劃（The "How Long"）

由於需要一個 90 天的初始訓練視窗，因此必須從滾動起點前 90 個交易日開始撈取資料。

| 項目 | 日期範圍 | 目的說明 |
|------|---------|---------|
| **初始緩衝區** | 2023 年 10 月 1 日 至 2023 年 12 月 31 日 | 提供給 Walk-Forward Engine 作為第一個訓練視窗 (2024/01/01) 的歷史輸入 |

**[程式化說明]**
此模組可對應到 Python 類別（class）或套件結構。

**[白話註解]**
這是一個功能單元，可以獨立開發與測試。

| **滾動測試區間** | 2024 年 1 月 1 日 至 2024 年 12 月 31 日 | 整個實戰模擬實驗室的運行區間 |
| **建議總撈取範圍** | 2023 年 10 月 1 日 至 2024 年 12 月 31 日 | 確保數據完整，共約 15 個月（約 300 個交易日） |


## 二、理論邏輯：必須強調「還原股價」


### 2.1 還原股價的重要性

如果使用未經還原的收盤價，當公司發放現金股利或股票股利時，股價會下跌，但這並非策略的真實虧損。

**錯誤影響**：
- 使用未還原價，會導致 Performance Analyzer 錯誤地計算出最大回檔 (Max Drawdown) 和夏普比率 (Sharpe Ratio)

**[外部知識補強]**
Sharpe Ratio 標準公式：

$$
\text{Sharpe} = \frac{R_p - R_f}{\sigma_p}
$$

其中：
- $R_p$ = 投資組合平均報酬率
- $R_f$ = 無風險利率（通常為0或國債利率）
- $\sigma_p$ = 投資組合報酬率標準差

年化 Sharpe = 日 Sharpe × $\sqrt{252}$（假設252個交易日）


**[外部知識補強]**
最大回撤（Max Drawdown）計算：

1. 計算累積淨值序列：$C_t = \prod_{i=1}^{t} (1 + r_i)$
2. 計算歷史最高點：$P_t = \max(C_1, C_2, ..., C_t)$
3. 計算回撤：$D_t = \frac{P_t - C_t}{P_t}$
4. 最大回撤 = $\max(D_1, D_2, ..., D_T)$

Python 實作：
```python
cumulative = (1 + returns).cumprod()
running_max = cumulative.expanding().max()
drawdown = (cumulative - running_max) / running_max
max_drawdown = drawdown.min()
```


**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

- 進而誤導萬物修復法則，讓 AI 以為策略虧損而啟動不必要的重訓

**解決方案**：
在 Python 撈取數據的程式碼中，必須使用 FinMind API 中提供還原功能的參數，這是我們理論驗證的基石。


## 三、J-GOD 的聖杯數據：基本面與宏觀因子輸入

這些數據主要用於 J-GOD V1.0 理論中的補強二（動態風險預算）和補強一（機制轉換偵測）。


### 3.1 基本面與價值指標（巴菲特哲學：選擇好公司）

這是用來衡量您的個股標的（例如 2330.TW）是否具備長期持有價值的數據。這些數據通常是季度或年度更新。

| 數據類別 | 必須撈取指標 (Quarterly/Annually) | 理論目的 (Factor F_Value) |
|---------|--------------------------------|------------------------|
| **品質 (Quality)** | 股東權益報酬率 (ROE)、淨利率 (Net Margin) | 評估公司的護城河（Moat）是否穩固 |
| **價值 (Value)** | 本益比 (P/E Ratio)、股價淨值比 (P/B Ratio) | 評估當前股價是否具備安全邊際 (Margin of Safety) |
| **成長 (Growth)** | 營收年增率 (Revenue YoY)、盈餘成長率 (EPS Growth) | 確認公司是否仍在成長期，而非夕陽產業 |
| **財務健康** | 負債權益比 (Debt/Equity Ratio) | 評估公司面臨宏觀風險時的財務韌性 |


### 3.2 宏觀與系統性風險指標（聖杯基金哲學：駕馭市場環境）

這是用來偵測整個市場環境是否適合積極交易的數據，通常用於 Regime-Switching Filter。

| 數據類別 | 必須撈取指標 (Daily/Weekly/Monthly) | 理論目的 (Factor F_Macro) |
|---------|-----------------------------------|--------------------------|
| **利率與資金成本** | 央行重貼現率、10 年期公債殖利率 | 評估無風險利率 R_f 的變化，直接影響股票估值和 RAROC 邏輯 |
| **匯率與流動性** | USD/TWD 匯率 (新台幣兌美元) | 評估外資熱錢流向與出口導向產業的匯兌風險 |
| **總體經濟** | CPI 年增率 (消費者物價指數) | 判斷通膨壓力，影響央行政策和市場流動性 |
| **市場情緒** | VIX 指數代理 (如台指選擇權的隱含波動率) | 機制轉換偵測器的核心輸入，一旦飆升即強制降風險 |


### 3.3 理論整合：如何應用這些聖杯數據

這些慢速、穩定的數據，在滾動式調整的架構中，主要發揮以下作用：

**[程式化說明]**
此模組可對應到 Python 類別（class）或套件結構。

**[白話註解]**
這是一個功能單元，可以獨立開發與測試。


**1. 動態風險預算 (補強二) 的錨定**：
- 如果 F_Macro 指標顯示：10 年期公債殖利率飆升（資金成本提高），J-GOD 必須依據 RAROC 邏輯，主動降低整體持倉的 Max Position Size，即使短線因子（F_C）看多

**2. 萬物修復法則的權重調整**：
- 在集中式學習日，如果 F_Value 顯示您的目標個股 P/E 過高（基本面風險大），萬物修復法則會學習在這種情況下，自動調低短線因子（F_C, F_Inertia）的決策權重，使策略更加謹慎


## 四、頂級量化機構的數據策略


### 4.1 Citadel 與 Medallion Fund 的數據哲學

**Citadel (Kenneth Griffin) 的哲學**：
- 著重於跨時間框架的高頻套利與市場效率
- 對應 J-GOD：體現在 Mode 1（高頻多空刷）以及 F_C (動量因子) 和 F_Inertia (慣性因子) 中，追求市場價格的微觀低效率

**Renaissance Technologies (Medallion Fund) 的哲學**：
- 著重於數學模型的純粹預測力，將所有市場現象視為可以被模型捕捉的訊號
- 對應 J-GOD：體現在集中式模型迭代和萬物修復法則中，系統對自身 AI 預測能力（Sharpe Ratio）的絕對信任與不斷優化

**[外部知識補強]**
Sharpe Ratio 標準公式：

$$
\text{Sharpe} = \frac{R_p - R_f}{\sigma_p}
$$

其中：
- $R_p$ = 投資組合平均報酬率
- $R_f$ = 無風險利率（通常為0或國債利率）
- $\sigma_p$ = 投資組合報酬率標準差

年化 Sharpe = 日 Sharpe × $\sqrt{252}$（假設252個交易日）



### 4.2 層級一：微觀結構與流動性（Citadel 哲學）

Citadel 的策略依賴於極高的交易速度和對市場微觀結構的理解，以捕捉轉瞬即逝的套利機會。

| 數據類別 | 撈取內容（台股對應） | Alpha 來源 |
|---------|-------------------|-----------|
| **高頻 Level 2 數據** | 五檔報價（Bid/Ask Price & Size）、最佳買賣價變動序列 | 偵測流動性枯竭或大型訂單進入市場的微觀壓力 |
| **逐筆交易明細** | 每一筆成交的價格、時間、量 | 這是計算 VWAP (成交量加權平均價) 和精確的訂單簿失衡（Order Book Imbalance）因子的基礎 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **委託量與取消率** | 每一秒的掛單與撤單次數及數量 | 衡量市場的隱藏情緒，掛單量增加代表潛在支撐/壓力，高取消率可能預示波動加劇 |


### 4.3 層級二：數據純度與領先指標（Medallion Fund 哲學）

Medallion Fund 的成功基於數學模型對市場模式的捕捉。他們需要最高純度的數據和能領先價格的統計訊號。

| 數據類別 | 撈取內容（台股對應） | Alpha 來源 |
|---------|-------------------|-----------|
| **期貨/選擇權數據** | 台指期貨、個股選擇權的未平倉量、隱含波動率 (Implied Volatility) | 隱含波動率是市場對未來風險的預期，是領先股價的宏觀情緒指標 |
| **跨市場相關性數據** | 美股主要指數 (S&P 500, NASDAQ)、亞洲主要市場指數 (日經 225) | 捕捉市場之間的傳導效應，利用隔夜市場的資訊來預測台股的開盤和日內走勢 |

**[外部知識補強]**
皮爾遜相關係數（Pearson Correlation）公式：

$$
\rho = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y} = \frac{E[(X-\mu_X)(Y-\mu_Y)]}{\sigma_X \sigma_Y}
$$

Python 實作：`np.corrcoef(x, y)[0, 1]` 或 `df.corr()`

| **券商分點進出** | 每日十大券商分點的買賣超數據 | 雖然是公開資訊，但他們會用統計模型分析分點的歷史勝率，將其轉換為領先因子 |

**[外部知識補強]**
勝率計算公式：

$$
\text{Win Rate} = \frac{\text{獲利交易數}}{\text{總交易數}} = \frac{N_{win}}{N_{total}}
$$

注意：通常定義「獲利交易」為 $P_nL > 0$（或 $P_nL > \epsilon$，避免手續費造成的小虧）。



### 4.4 層級三：數據噪聲與異常值（萬物修復法則的延伸）

頂級量化機構會將數據中的**噪聲（Noise）**本身也視為訊號，用於風控。

| 數據類別 | 撈取內容（台股對應） | Alpha 來源 |
|---------|-------------------|-----------|
| **數據異常標籤** | 盤中漲跌停次數、暫停交易次數 | 用於觸發 DQA (數據品質保證) 機制，在異常情況下強制關閉模型，避免損失 |
| **流動性分層** | 個股的流動性分組（高/中/低） | 用於補強八：參數敏感度分析，高流動性組的參數可能不同於低流動性組，讓模型學習在不同流動性環境下進行參數調整 |


## 五、頂級量化對沖基金在台股的籌碼分析清單


### 5.1 法人交易動態 (Daily)

這是最直接反映市場主要參與者（外資、投信、自營商）行為的數據。

| 欄位/分析項目 | 理論目的（行為洞察） | J-GOD 因子應用 |

**[程式化說明]**
此結構可用 dataclass 或 DataFrame 表示。

|-------------|-------------------|---------------|
| **三大法人總買賣超金額 (個股)** | 判斷當日個股的主要買賣壓力來自何方 | F_CapitalFlow |
| **外資買賣超張數 (個股)** | 外資通常是中長期趨勢和流動性的指標 | F_Inertia (中長慣性) |
| **投信買賣超張數 (個股)** | 投信通常有季度結帳和績效排名壓力，是短期特定目標的領先訊號 | F_C (短期動量) |
| **自營商買賣超張數 (個股)** | 自營商多為短線造市或避險，其行為可作為市場微觀波動的參考 | F_Inertia (短期噪音) |


### 5.2 法人累積與集中度 (Derived / 需 Python 運算)

頂級量化機構不會只看單日的買賣超，他們更關心行為的持續性和集中性。這需要 Python 根據原始數據進行計算。

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```


| 衍生分析項目 | 運算邏輯 | 理論目的（趨勢慣性） |
|------------|---------|-------------------|
| **法人連續買超天數** | 計算外資或投信連續淨買入的天數 (1,2,3...) | 偵測法人一致性的中短期慣性訊號 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **累積買賣超庫存** | 計算特定天數（例如近 5 日/20 日）的淨買入總張數 | 衡量法人累積的籌碼壓力，預估潛在的拋壓或支撐 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **特定券商分點買賣超** | Top 10 券商分點的淨買賣超數據 | 偵測是否有單一大型機構或神秘大戶的行為，判斷籌碼是否集中 |
| **三大法人持股比例變化** | 每日/週的總持股比例變動 | 評估籌碼的長期鎖定程度，判斷個股的系統性風險 |


### 5.3 理論整合：如何應用於 J-GOD 的修復法則

這些籌碼數據對萬物修復法則提供了寶貴的**「非價格」**視角：

**1. 策略驗證 (Path A)**：
- 如果 J-GOD 的策略在 T+1 日成功預測了上漲，但當日三大法人是淨賣超，這代表 J-GOD 發現了一個**「散戶推動的 Alpha」**。這是一個寶貴的發現，應被記錄為模型的非典型成功

**2. 風險預算 (補強二)**：
- 如果 F_CapitalFlow 顯示外資連續 5 日大額淨賣超，即使短線技術面看多，動態風險預算也應基於長期慣性壓力而強制降低持倉部位

**3. 衝突解決 (Mode 2)**：
- 當 0.03% 衝突發生時，如果籌碼分析顯示投信正在連續大額買入，則「三重審查決策樹」會傾向於「AI 高壓堅持續抱」，因為有強勢的機構資金在背後支撐


## 六、三大深度分析資料維度


### 6.1 補強十一：散戶情緒與市場噪音（Retail Sentiment & Noise）

Citadel 和 Medallion Fund 會特別分析散戶的非理性行為，因為這些行為往往是短期慣性（F_Inertia）和反轉機會的來源。

| 數據類別 | 撈取內容（台股對應） | 理論目的（F_Noise/F_Inertia） | 強化分析點 |
|---------|-------------------|---------------------------|-----------|
| **融資融券數據** | 每日融資餘額、融券餘額、資券變化率 | 衡量散戶的情緒槓桿。融資大增通常預示市場過熱，是潛在反轉的訊號 | 頂部訊號分析：策略在高點反轉時，是否成功利用融資餘額的極值進行判斷 |
| **市場成交筆數** | 每日總成交筆數 | 筆數增加但量能持平，可能代表散戶小額交易增加（市場噪音） | 噪音過濾：分析策略在市場噪音高的日子是否表現較差，應啟動 Regime Switch |
| **股權結構 (集保庫存)** | 集保戶股權分散表（週/雙週） | 了解籌碼是否從大戶流向散戶，作為長期持股慣性的評估 | 長期結構分析：輔助 F_Value 因子，判斷股票是否進入危險的「散戶高持股區」 |


### 6.2 補強十二：交易日曆與外部衝擊（External Shocks & Calendar Effects）

市場有其特定的「週期性魔咒」和「已知衝擊點」。頂級量化機構會將這些日期標註，避免 AI 在這些日子過度自信。

| 數據類別 | 撈取內容（台股對應） | 理論目的（F_Calendar/F_Shock） | 強化分析點 |
|---------|-------------------|---------------------------|-----------|
| **財報與法說會日期** | 季度財報公告日、法說會舉辦日 | 預期市場對財報的超預期或低預期反應 | 黑箱事件分析：策略在哪次財報前失誤？協助萬物修復法則隔離財報衝擊點 |
| **除權息與增減資公告** | 具體的除權息基準日 | 確保還原股價（補強七）的精確性，並用於 DQA（補強三）檢查數據 | 數據淨化：確認所有因子計算在除權息當天都沒有被錯誤的原始數據影響 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **台灣/國際假期** | 具體休市日期 | 避免模型學習到節前效應 (Holiday Effect) 等偽訊號 | 異常分析：分析策略在節日前後是否表現出系統性偏差 |


### 6.3 補強十三：跨資產相關性與 Beta 結構（Cross-Asset & Beta Dynamics）

**[外部知識補強]**
Beta 係數計算公式（資本資產定價模型，CAPM）：

$$
\beta = \frac{\text{Cov}(R_i, R_m)}{\text{Var}(R_m)} = \frac{\sigma_{i,m}}{\sigma_m^2}
$$

其中：
- $R_i$ = 資產報酬率
- $R_m$ = 市場報酬率
- $\sigma_{i,m}$ = 資產與市場的協方差
- $\sigma_m^2$ = 市場報酬率方差

Python 實作：`beta = np.cov(asset_returns, market_returns)[0,1] / np.var(market_returns)`


**[外部知識補強]**
皮爾遜相關係數（Pearson Correlation）公式：

$$
\rho = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y} = \frac{E[(X-\mu_X)(Y-\mu_Y)]}{\sigma_X \sigma_Y}
$$

Python 實作：`np.corrcoef(x, y)[0, 1]` 或 `df.corr()`


J-GOD 必須了解目標個股與整體市場之間的風險關係，這對於動態風險預算（補強二）和 RAROC 邏輯（補強九）至關重要。

| 數據類別 | 撈取內容（台股對應） | 理論目的（F_Correlation/F_Beta） | 強化分析點 |

**[外部知識補強]**
Beta 係數計算公式（資本資產定價模型，CAPM）：

$$
\beta = \frac{\text{Cov}(R_i, R_m)}{\text{Var}(R_m)} = \frac{\sigma_{i,m}}{\sigma_m^2}
$$

其中：
- $R_i$ = 資產報酬率
- $R_m$ = 市場報酬率
- $\sigma_{i,m}$ = 資產與市場的協方差
- $\sigma_m^2$ = 市場報酬率方差

Python 實作：`beta = np.cov(asset_returns, market_returns)[0,1] / np.var(market_returns)`


**[外部知識補強]**
皮爾遜相關係數（Pearson Correlation）公式：

$$
\rho = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y} = \frac{E[(X-\mu_X)(Y-\mu_Y)]}{\sigma_X \sigma_Y}
$$

Python 實作：`np.corrcoef(x, y)[0, 1]` 或 `df.corr()`

|---------|-------------------|-------------------------------|-----------|
| **個股與大盤的日報酬率** | 大盤指數 (TSE001) 與個股的每日百分比報酬率 | 這是計算個股 Beta 值的基礎，衡量個股對大盤系統風險的敏感度 | 風險預算調控：當個股 Beta 過高時，應在市場下跌時強制降低部位 |

**[外部知識補強]**
Beta 係數計算公式（資本資產定價模型，CAPM）：

$$
\beta = \frac{\text{Cov}(R_i, R_m)}{\text{Var}(R_m)} = \frac{\sigma_{i,m}}{\sigma_m^2}
$$

其中：
- $R_i$ = 資產報酬率
- $R_m$ = 市場報酬率
- $\sigma_{i,m}$ = 資產與市場的協方差
- $\sigma_m^2$ = 市場報酬率方差

Python 實作：`beta = np.cov(asset_returns, market_returns)[0,1] / np.var(market_returns)`


**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **板塊/產業指數** | 主要產業指數（例如電子、金融、傳產）的日報酬率 | 衡量個股是否遵循產業輪動，隔離系統性風險 | 風險歸因：當策略虧損時，是否是因為整個電子板塊崩跌（系統風險），而非策略本身失效（Alpha 歸因） |


## 七、J-GOD V1.0 最終歷史數據撈取清單


### 7.1 目標與範圍

**目標**：撈取 2023 年 10 月 1 日至 2024 年 12 月 31 日期間的所有數據。


### 7.2 I. 核心交易與價格訊號 (Core Price & Execution)

這是計算所有技術因子和模擬交易的基礎。

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```


| 資料項目 | 頻率 | 理論應用 | 關鍵分析點 |
|---------|------|---------|-----------|
| **還原收盤價 (Adjusted Close Price)** | 日 (Daily) | PnL 計算、F_C (動量因子) | 核心：必須是還原價，確保損益真實性 |

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **開盤價、最高價、最低價** | 日 (Daily) | 模擬進場價、DQA (數據品質) | 模擬滑價成本，以及盤中 MaxDD 觸發檢查 |
| **成交量 (Trading Volume)** | 日 (Daily) | F_Inertia (慣性)、流動性分析 | 判斷資金動能的真實性 |
| **成交筆數 (Ticket Count)** | 日 (Daily) | F_Noise (市場噪音) | 輔助判斷是散戶交易多（高噪音）還是大戶交易多 |


### 7.3 II. 籌碼與資金流向 (Capital Flow & Sentiment)

這是判斷 F_CapitalFlow 和 F_Noise 的關鍵，捕捉市場參與者的行為。

| 資料項目 | 頻率 | 理論應用 | 關鍵分析點 |
|---------|------|---------|-----------|
| **三大法人買賣超 (外資、投信、自營商)** | 日 (Daily) | F_CapitalFlow | 判斷短期籌碼壓力與連續買賣超慣性 |
| **融資融券餘額 (Margin & Short Balance)** | 日 (Daily) | F_Noise (散戶情緒) | 極值可用於偵測市場過熱或過度恐慌的反向訊號 |
| **股權分散表 (集保庫存)** | 週/雙週 | F_Noise (長期結構) | 輔助判斷籌碼是集中於大戶，還是分散給散戶 |


### 7.4 III. 基本面與價值結構 (Fundamental & Quality)

這是支持 F_Value 和萬物修復法則進行長期風險評估的依據。

| 資料項目 | 頻率 | 理論應用 | 關鍵分析點 |
|---------|------|---------|-----------|
| **股東權益報酬率 (ROE)** | 季 (Quarterly) | F_Value (品質 Moat) | 評估公司獲利能力和管理效率 |
| **本益比 (P/E Ratio)** | 日 (Daily) / 季 (Quarterly) | F_Value (價值安全邊際) | 判斷個股價格是否進入合理估值區間 |
| **營收年增率 (Revenue YoY)** | 月 (Monthly) / 季 (Quarterly) | F_Value (成長性) | 驗證成長趨勢是否持續，避免模型追逐夕陽產業 |


### 7.5 IV. 宏觀與外部風險 (Macro & Calendar)

這是啟動 Regime-Switching Filter 和 RAROC 邏輯的核心數據。

| 資料項目 | 頻率 | 理論應用 | 關鍵分析點 |
|---------|------|---------|-----------|
| **大盤指數 (TSE001) 報酬率** | 日 (Daily) | F_Beta, F_Correlation | 計算個股對系統風險的敏感度 |

**[外部知識補強]**
Beta 係數計算公式（資本資產定價模型，CAPM）：

$$
\beta = \frac{\text{Cov}(R_i, R_m)}{\text{Var}(R_m)} = \frac{\sigma_{i,m}}{\sigma_m^2}
$$

其中：
- $R_i$ = 資產報酬率
- $R_m$ = 市場報酬率
- $\sigma_{i,m}$ = 資產與市場的協方差
- $\sigma_m^2$ = 市場報酬率方差

Python 實作：`beta = np.cov(asset_returns, market_returns)[0,1] / np.var(market_returns)`


**[外部知識補強]**
皮爾遜相關係數（Pearson Correlation）公式：

$$
\rho = \frac{\text{Cov}(X, Y)}{\sigma_X \sigma_Y} = \frac{E[(X-\mu_X)(Y-\mu_Y)]}{\sigma_X \sigma_Y}
$$

Python 實作：`np.corrcoef(x, y)[0, 1]` 或 `df.corr()`


**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

| **台灣/美國 公債殖利率 (例如 10 年期)** | 日 (Daily) | F_Macro, RAROC Logic | 衡量無風險利率 R_f 的變化，影響資金成本和估值 |
| **外國主要指數日報酬 (例如 S&P 500)** | 日 (Daily) | F_Macro (跨市場傳導) | 分析隔夜市場對台股的影響 |
| **財報與除權息日期清單** | 事件 (Event) | DQA, F_Calendar | 標記日期，將這些「已知衝擊」與模型的失誤隔離 |


## 八、Path A DataFetcher 的核心職責


### 8.1 嚴格時間戳記隔離

**最關鍵的提醒**：
所有這些資料撈取都必須遵循「嚴格時間戳記隔離」的原則。

**範例**：
- 計算 P/E Ratio 時使用的最新每股盈餘 (EPS)，必須是前一季已經公告的數字

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```

- 不能使用最新的未公告或預測 EPS，以避免任何「未來函數」導致的成本驗證失準


### 8.2 數據品質要求

在 Path A 階段，DataFetcher 的職責是提供「乾淨、還原、且多維度」的數據給 Walk-Forward Engine。

**[程式化說明]**
此模組可對應到 Python 類別（class）或套件結構。

**[白話註解]**
這是一個功能單元，可以獨立開發與測試。


**關鍵強調**：
必須確保所有數據的時間戳記是「已知」的，例如：計算 2024/04/01 的 F_Value 時，只能使用 2024 年 Q1 或更早的已公告財報數據。這就是「嚴格時間戳記隔離」的體現。

**[程式化說明]**
此計算可用 NumPy/Pandas 實現：

```python
# import numpy as np
# result = np.mean(data)  # 或其他計算
```



## 九、最終理論：對「分析強化」的總結

有了這七大類、數十個指標的歷史數據，J-GOD 在進行 2024 年滾動回測時，可以達成一個世界級的分析效果：

**虧損報告範例**：
當策略在 2024 年 5 月 20 日虧損時，系統能立即生成一份「虧損報告」：

1. **AI 決策層**：F_C 看多，但 F_Inertia 看空
2. **市場機制層**：Regime Switch Filter 顯示 VIX 代理指標已在 5/18 啟動警報
3. **籌碼情緒層**：5/19 融資餘額創 3 個月新高，散戶情緒極度樂觀
4. **修復法則診斷**：「策略錯誤歸因：F_C 被短期噪音誤導；應依據 F_Noise（散戶過熱）和 Regime Switch 啟動避險機制。」

這才是「萬物修復法則」能夠自我學習、自我改進的真正基礎。

*本文件基於原始對話內容整理，所有技術邏輯與戰略思考均已完整保留。*

